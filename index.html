<!DOCTYPE html>
<html lang="en">
<head>
  <title>Arcom Control Panel</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" type="text/css" href="https:/arcom.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
  <script src="https:/jquery.xmlrpc.js"></script>
  <script>
    //TODO(dpk): this needs to be initialized at login time or via dialog.
    var call = "KD7DK";
    var place = "CN87tq";

    function updateResponse(response, status, jqXHR) {
      $("#response").html('<div class="well well-sm"> '+response[0]+'</div>')
    }

    function callRPC(func, params, callback){
      var rpcURL = "https:/RPC2";

      if (!callback) callback = updateResponse;

      $.xmlrpc({
        url: rpcURL,
        methodName: func,
        params: params,
        success: callback,
        error: function(jqXHR, status, error) { alert("RPC FAIL: "+func) }
      });
    };

    function setTitle(response, status, jqXHR){
      var identity = response;
      $("#title").html('<h2>Repeater Control - '+identity+'</h2>');
    }

    function updateStatus(response, status, jqXHR){
      callRPC("status", [call], setStatus);
    }

    function setStatus(response, status, jqXHR){
      var html = '';
      var obj = response[0]

      html = '<table class=\"table table-condensed\"><tbody>'
      for (var item in obj) {
        html += "<tr><td>" + item + "</td><td>" + obj[item] + "</td></tr>"
      }
      html += "</tbody></table>"
      $("#status-content").html(html);
    }

    function disableAndLog(call, mins){
      callRPC("port1Disable", [call, mins], updateStatus);
      callRPC("logInterference", [call, place, mins]);
    }

    $(document).ready(function(){
      callRPC("getIdentity", [call], setTitle);
      callRPC("status", [call], setStatus);
      $("#port1Disable5").bind('click', function (){
          bootbox.confirm("Confirm disable?", function(result){
              if (result) disableAndLog(call, 300);
          })
      });
      $("#port1Disable10").bind('click', function (){
          bootbox.confirm("Confirm disable?", function(result){
              if (result) disableAndLog(call, 600);
          })
      });
      $("#port1Disable15").bind('click', function (){
          bootbox.confirm("Confirm disable?", function(result){
              if (result) disableAndLog(call, 900);
          })
      });
      $("#port1Disable").bind('click', function (){
          bootbox.confirm("Confirm disable?", function(result){
              if (result) callRPC("port1Disable", [call, 0], updateStatus);
          })
      });
      $("#port1Enable").bind('click', function (){callRPC("port1Enable", [call], updateStatus)});
      $("#port3Unbridge").bind('click', function (){
          bootbox.confirm("Confirm unbridging 1 & 3?", function(result){
              if (result) callRPC("port3Unbridge", [call], updateStatus);
          })
      });
      $("#port3Bridge").bind('click', function (){callRPC("port3Bridge", [call], updateStatus)});
      $("#setDateTime").bind('click', function (){
          bootbox.confirm("Confirm setting date/time?", function(result){
              if (result) callRPC("setDateTime", [call]);
          })
      });
      $("#getIdentity").bind('click', function (){callRPC("getIdentity", [call], setTitle)});
      $("#getStatus").bind('click', function (){callRPC("status", [call], setStatus)});
      $("#getLog").bind('click', function (){callRPC("getLog", [call, 10])});
      $("#logInterference").bind('click', function (){
          bootbox.confirm("Confirm logging?", function(result){
              if (result) callRPC("logInterference", [call, place, 300]);
          })
      });
      $("#setViolator").bind('click', function (){
          bootbox.prompt({
            title: "This is a prompt with select!",
            inputType: 'select',
            inputOptions: [
              { text: 'Violator Alpha (falsetto)',
                value: 'Violator Alfa (High pitched, falsetto, singing, swearing)', },
              { text: 'Violator Beta (Doubler)',
                value: 'Violator Bravo ("Doubler", doubles with net checkins, occasional other comments)', },
              { text: 'Violator Charlie',
                value: 'Violator Charlie (some third person)', },
              { text: 'Someone else', value: 'other', }
            ],
            callback: function (result) {
              if (result != null) callRPC("setViolator", [call, result]);
            }
         });
      });
    })
  </script>
</head>

<body>
<div class="container">
  <div id="header" class="row">
    <div id="title"><h2>Repeater Control</h2></div>
    <h3>Status</h3>
    <div class="col-sm-4">
      <div id="status-content"></div>
    </div>
  </div>
  <div class="row">
    <h3>Commands</h3>
    <div id="menu1" class="btn-group-vertical" class="btn-group-xs" class="col-sm-4">
      <button type="button" class="btn btn-danger"
	      id="port1Disable5">Port 1 Disable for 5 minutes</button><br>
      <button type="button" class="btn btn-danger"
	      id="port1Disable10">Port 1 Disable for 10 minutes</button><br>
      <button type="button" class="btn btn-danger"
	      id="port1Disable15">Port 1 Disable for 15 minutes</button><br>
      <button type="button" class="btn btn-danger"
	      id="port1Disable">Port 1 Disable</button><br>
      <button type="button" class="btn btn-danger"
	      id="port3Unbridge">Unbridge Port 1-to-3</button><br>
      <button type="button" class="btn btn-danger"
	      id="restart">Restart</button><br>
      <button type="button" class="btn btn-warning"
	      id="setDateTime">Set Date & Time</button><br>
    </div> 
    <div id="menu2" class="btn-group-vertical" class="btn-group-xs" class="col-sm-4">
      <button type="button" class="btn btn-info"
	      id="getIdentity">Identity</button><br>
      <button type="button" class="btn btn-info"
	      id="getStatus">Status</button><br>
      <button type="button" class="btn btn-info"
	      id="getLog">Get Recent Activity</button><br>
      <button type="button" class="btn btn-success"
	      id="port1Enable">Port 1 Enable</button><br>
      <button type="button" class="btn btn-success"
	      id="port3Bridge">Bridge Port 1-to-3</button><br>
      <button type="button" class="btn btn-warning"
	      id="logInterference">logInterference</button><br>
      <button type="button" class="btn btn-default"
	      id="bar">(unused) </button><br>
    </div>
  </div>
  <div id="response" class="row">
  </div>
</div>

</body>
</html>
